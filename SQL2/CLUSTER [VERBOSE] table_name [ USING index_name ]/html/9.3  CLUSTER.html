<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0058)http://www.postgresql.org/docs/9.3/static/sql-cluster.html -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>PostgreSQL: Documentation: 9.3: CLUSTER</title>
    <style type="text/css" media="screen" title="Normal Text">@import url("/media/css/docs.css");</style>
    <link rel="alternate stylesheet" media="screen" href="./9.3  CLUSTER_files/docs_large.css" type="text/css" title="Large Text" disabled="">
    <script type="text/javascript" async="" src="./9.3  CLUSTER_files/ga.js"></script><script type="text/javascript" src="./9.3  CLUSTER_files/styleswitcher.js"></script>
    <script type="text/javascript" src="./9.3  CLUSTER_files/monospacefix.js"></script></head><body><pre id="monotest" style="display: none;">&nbsp;</pre><p id="paratest" style="display: none;">&nbsp;</p><style type="text/css" media="screen">#docContainer tt, #docContainer pre, #docContainer code{font-size: 1.2em;}</style>

    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1345454-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


<div id="docHeader">
	<div id="docHeaderLogo">
		<a href="http://www.postgresql.org/" title="PostgreSQL"><img src="./9.3  CLUSTER_files/hdr_logo.png" width="206" height="80" alt="PostgreSQL"></a>
	</div>
</div>

<div id="docContainerWrap">
<div id="docContainer">
<div id="docNavSearchContainer">
<div id="docSearch">
	<form action="http://www.postgresql.org/search/" method="get">
	<div>
	<input type="hidden" name="u" value="/docs/9.3/">
	<label for="q">Search Documentation:&nbsp;</label><input type="text" id="q" name="q" size="20" onfocus="if( this.value==this.defaultValue ) this.value=&#39;&#39;;" value="Search"><input id="submit" type="submit" value="Search">
	</div>
	</form>
        <div id="docTextSize">Text Size: <a href="http://www.postgresql.org/docs/9.3/static/sql-cluster.html#" onclick="setActiveStyleSheet(&#39;Normal Text&#39;); return false;" onkeypress="return false;" title="Normal Text Size">Normal</a> / <a href="http://www.postgresql.org/docs/9.3/static/sql-cluster.html#" onclick="setActiveStyleSheet(&#39;Large Text&#39;); return false;" onkeypress="return false;" title="Large Text Size">Large</a></div>
</div>
<div id="docNav">
<a href="http://www.postgresql.org/" title="Home">Home</a> → <a href="http://www.postgresql.org/docs" title="Documentation">Documentation</a> → <a href="http://www.postgresql.org/docs/manuals" title="Manuals">Manuals</a> → <a href="http://www.postgresql.org/docs/9.3/static/index.html">PostgreSQL 9.3</a>
</div>
<div id="docVersions">

This page in other versions:

	
	
	<a href="http://www.postgresql.org/docs/9.2/static/sql-cluster.html" title="This page in version 9.2">9.2</a>
	

	/
	
	<a href="http://www.postgresql.org/docs/9.1/static/sql-cluster.html" title="This page in version 9.1">9.1</a>
	

	/
	
	<a href="http://www.postgresql.org/docs/9.0/static/sql-cluster.html" title="This page in version 9.0">9.0</a>
	

	/
	
	<a href="http://www.postgresql.org/docs/8.4/static/sql-cluster.html" title="This page in version 8.4">8.4</a>
	



&nbsp;|&nbsp; Unsupported versions:

	
	
	<b>9.3</b>
	

	/
	
	<a href="http://www.postgresql.org/docs/8.3/static/sql-cluster.html" title="This page in version 8.3" rel="nofollow">8.3</a>
	

	/
	
	<a href="http://www.postgresql.org/docs/8.2/static/sql-cluster.html" title="This page in version 8.2" rel="nofollow">8.2</a>
	

	/
	
	<a href="http://www.postgresql.org/docs/8.1/static/sql-cluster.html" title="This page in version 8.1" rel="nofollow">8.1</a>
	

	/
	
	<a href="http://www.postgresql.org/docs/8.0/static/sql-cluster.html" title="This page in version 8.0" rel="nofollow">8.0</a>
	

	/
	
	<a href="http://www.postgresql.org/docs/7.4/static/sql-cluster.html" title="This page in version 7.4" rel="nofollow">7.4</a>
	

	/
	
	<a href="http://www.postgresql.org/docs/7.3/static/sql-cluster.html" title="This page in version 7.3" rel="nofollow">7.3</a>
	

	/
	
	<a href="http://www.postgresql.org/docs/7.2/static/sql-cluster.html" title="This page in version 7.2" rel="nofollow">7.2</a>
	

	/
	
	<a href="http://www.postgresql.org/docs/7.1/static/sql-cluster.html" title="This page in version 7.1" rel="nofollow">7.1</a>
	

	/
	
	<a href="http://www.postgresql.org/docs/devel/static/sql-cluster.html" title="This page in version devel" rel="nofollow">devel</a>
	


</div>
</div>

<div id="docContent">
<div class="NAVHEADER">
  <table summary="Header navigation table" width="100%" border="0" cellpadding="0" cellspacing="0">
    <tbody><tr>
      <th colspan="5" align="center" valign="bottom"><a href="http://www.postgresql.org/docs/9.3/static/index.html">PostgreSQL 9.3beta2 Documentation</a></th>
    </tr>

    <tr>
      <td width="10%" align="left" valign="top"><a title="CLOSE" href="http://www.postgresql.org/docs/9.3/static/sql-close.html" accesskey="P">Prev</a></td>

      <td width="10%" align="left" valign="top"><a href="http://www.postgresql.org/docs/9.3/static/sql-commands.html" accesskey="U">Up</a></td>

      <td width="60%" align="center" valign="bottom"></td>

      <td width="20%" align="right" valign="top"><a title="COMMENT" href="http://www.postgresql.org/docs/9.3/static/sql-comment.html" accesskey="N">Next</a></td>
    </tr>
  </tbody></table>
  <hr class="c1" width="100%">
</div>

<h1><a name="SQL-CLUSTER" id="SQL-CLUSTER"></a>CLUSTER</h1>

<div class="REFNAMEDIV">
  <a name="AEN68127" id="AEN68127"></a>

  <h2>Name</h2>CLUSTER&nbsp;--&nbsp;cluster a table according to an
  index
</div>

<div class="REFSYNOPSISDIV">
  <a name="AEN68132" id="AEN68132"></a>

  <h2>Synopsis</h2>
  <pre class="SYNOPSIS">CLUSTER [VERBOSE] <tt class="REPLACEABLE c2">table_name</tt> [ USING <tt class="REPLACEABLE c2">index_name</tt> ]
CLUSTER [VERBOSE]
</pre>
</div>

<div class="REFSECT1">
  <a name="AEN68136" id="AEN68136"></a>

  <h2>Description</h2>

  <p><tt class="COMMAND">CLUSTER</tt> instructs <span class="PRODUCTNAME">PostgreSQL</span> to cluster the table specified by
  <tt class="REPLACEABLE c2">table_name</tt> based on the index
  specified by <tt class="REPLACEABLE c2">index_name</tt>. The
  index must already have been defined on <tt class="REPLACEABLE c2">table_name</tt>.</p>

  <p>When a table is clustered, it is physically reordered based on
  the index information. Clustering is a one-time operation: when
  the table is subsequently updated, the changes are not clustered.
  That is, no attempt is made to store new or updated rows
  according to their index order. (If one wishes, one can
  periodically recluster by issuing the command again. Also,
  setting the table's <tt class="LITERAL">FILLFACTOR</tt> storage
  parameter to less than 100% can aid in preserving cluster
  ordering during updates, since updated rows are kept on the same
  page if enough space is available there.)</p>

  <p>When a table is clustered, <span class="PRODUCTNAME">PostgreSQL</span> remembers which index it was
  clustered by. The form <tt class="COMMAND">CLUSTER <tt class="REPLACEABLE c2">table_name</tt></tt> reclusters the table using
  the same index as before. You can also use the <tt class="LITERAL">CLUSTER</tt> or <tt class="LITERAL">SET WITHOUT
  CLUSTER</tt> forms of <a href="http://www.postgresql.org/docs/9.3/static/sql-altertable.html">ALTER
  TABLE</a> to set the index to be used for future cluster
  operations, or to clear any previous setting.</p>

  <p><tt class="COMMAND">CLUSTER</tt> without any parameter
  reclusters all the previously-clustered tables in the current
  database that the calling user owns, or all such tables if called
  by a superuser. This form of <tt class="COMMAND">CLUSTER</tt>
  cannot be executed inside a transaction block.</p>

  <p>When a table is being clustered, an <tt class="LITERAL">ACCESS
  EXCLUSIVE</tt> lock is acquired on it. This prevents any other
  database operations (both reads and writes) from operating on the
  table until the <tt class="COMMAND">CLUSTER</tt> is finished.</p>
</div>

<div class="REFSECT1">
  <a name="AEN68159" id="AEN68159"></a>

  <h2>Parameters</h2>

  <div class="VARIABLELIST">
    <dl>
      <dt><tt class="REPLACEABLE c2">table_name</tt></dt>

      <dd>
        <p>The name (possibly schema-qualified) of a table.</p>
      </dd>

      <dt><tt class="REPLACEABLE c2">index_name</tt></dt>

      <dd>
        <p>The name of an index.</p>
      </dd>

      <dt><tt class="LITERAL">VERBOSE</tt></dt>

      <dd>
        <p>Prints a progress report as each table is clustered.</p>
      </dd>
    </dl>
  </div>
</div>

<div class="REFSECT1">
  <a name="AEN68177" id="AEN68177"></a>

  <h2>Notes</h2>

  <p>In cases where you are accessing single rows randomly within a
  table, the actual order of the data in the table is unimportant.
  However, if you tend to access some data more than others, and
  there is an index that groups them together, you will benefit
  from using <tt class="COMMAND">CLUSTER</tt>. If you are
  requesting a range of indexed values from a table, or a single
  indexed value that has multiple rows that match, <tt class="COMMAND">CLUSTER</tt> will help because once the index
  identifies the table page for the first row that matches, all
  other rows that match are probably already on the same table
  page, and so you save disk accesses and speed up the query.</p>

  <p><tt class="COMMAND">CLUSTER</tt> can re-sort the table using
  either an index scan on the specified index, or (if the index is
  a b-tree) a sequential scan followed by sorting. It will attempt
  to choose the method that will be faster, based on planner cost
  parameters and available statistical information.</p>

  <p>When an index scan is used, a temporary copy of the table is
  created that contains the table data in the index order.
  Temporary copies of each index on the table are created as well.
  Therefore, you need free space on disk at least equal to the sum
  of the table size and the index sizes.</p>

  <p>When a sequential scan and sort is used, a temporary sort file
  is also created, so that the peak temporary space requirement is
  as much as double the table size, plus the index sizes. This
  method is often faster than the index scan method, but if the
  disk space requirement is intolerable, you can disable this
  choice by temporarily setting <a href="http://www.postgresql.org/docs/9.3/static/runtime-config-query.html#GUC-ENABLE-SORT">enable_sort</a> to
  <tt class="LITERAL">off</tt>.</p>

  <p>It is advisable to set <a href="http://www.postgresql.org/docs/9.3/static/runtime-config-resource.html#GUC-MAINTENANCE-WORK-MEM">maintenance_work_mem</a>
  to a reasonably large value (but not more than the amount of RAM
  you can dedicate to the <tt class="COMMAND">CLUSTER</tt>
  operation) before clustering.</p>

  <p>Because the planner records statistics about the ordering of
  tables, it is advisable to run <a href="http://www.postgresql.org/docs/9.3/static/sql-analyze.html">ANALYZE</a> on the newly clustered table.
  Otherwise, the planner might make poor choices of query
  plans.</p>

  <p>Because <tt class="COMMAND">CLUSTER</tt> remembers which
  indexes are clustered, one can cluster the tables one wants
  clustered manually the first time, then set up a periodic
  maintenance script that executes <tt class="COMMAND">CLUSTER</tt>
  without any parameters, so that the desired tables are
  periodically reclustered.</p>
</div>

<div class="REFSECT1">
  <a name="AEN68196" id="AEN68196"></a>

  <h2>Examples</h2>

  <p>Cluster the table <tt class="LITERAL">employees</tt> on the
  basis of its index <tt class="LITERAL">employees_ind</tt>:</p>
  <pre class="PROGRAMLISTING">CLUSTER employees USING employees_ind;
</pre>

  <p>Cluster the <tt class="LITERAL">employees</tt> table using the
  same index that was used before:</p>
  <pre class="PROGRAMLISTING">CLUSTER employees;
</pre>

  <p>Cluster all tables in the database that have previously been
  clustered:</p>
  <pre class="PROGRAMLISTING">CLUSTER;
</pre>
</div>

<div class="REFSECT1">
  <a name="AEN68207" id="AEN68207"></a>

  <h2>Compatibility</h2>

  <p>There is no <tt class="COMMAND">CLUSTER</tt> statement in the
  SQL standard.</p>

  <p>The syntax</p>
  <pre class="SYNOPSIS">CLUSTER <tt class="REPLACEABLE c2">index_name</tt> ON <tt class="REPLACEABLE c2">table_name</tt>
</pre>

  <p>is also supported for compatibility with pre-8.3 <span class="PRODUCTNAME">PostgreSQL</span> versions.</p>
</div>

<div class="REFSECT1">
  <a name="AEN68216" id="AEN68216"></a>

  <h2>See Also</h2><a href="http://www.postgresql.org/docs/9.3/static/app-clusterdb.html"><span class="APPLICATION">clusterdb</span></a>
</div>

<div class="NAVFOOTER">
  <hr class="c1" width="100%">

  <table summary="Footer navigation table" width="100%" border="0" cellpadding="0" cellspacing="0">
    <tbody><tr>
      <td width="33%" align="left" valign="top"><a href="http://www.postgresql.org/docs/9.3/static/sql-close.html" accesskey="P">Prev</a></td>

      <td width="34%" align="center" valign="top"><a href="http://www.postgresql.org/docs/9.3/static/index.html" accesskey="H">Home</a></td>

      <td width="33%" align="right" valign="top"><a href="http://www.postgresql.org/docs/9.3/static/sql-comment.html" accesskey="N">Next</a></td>
    </tr>

    <tr>
      <td width="33%" align="left" valign="top">CLOSE</td>

      <td width="34%" align="center" valign="top"><a href="http://www.postgresql.org/docs/9.3/static/sql-commands.html" accesskey="U">Up</a></td>

      <td width="33%" align="right" valign="top">COMMENT</td>
    </tr>
  </tbody></table>
</div>

</div>

<div id="docComments">



</div>

<div id="docFooter">
    <a href="http://www.postgresql.org/about/privacypolicy">Privacy Policy</a> |
    <a href="http://www.postgresql.org/about/">About PostgreSQL</a><br>
Copyright © 1996-2013 The PostgreSQL Global Development Group
</div>
</div>
</div>


</body></html>