<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0058)http://www.postgresql.org/docs/9.3/static/sql-prepare.html -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>PostgreSQL: Documentation: 9.3: PREPARE</title>
    <style type="text/css" media="screen" title="Normal Text">@import url("/media/css/docs.css");</style>
    <link rel="alternate stylesheet" media="screen" href="./9.3  PREPARE_files/docs_large.css" type="text/css" title="Large Text" disabled="">
    <script type="text/javascript" async="" src="./9.3  PREPARE_files/ga.js"></script><script type="text/javascript" src="./9.3  PREPARE_files/styleswitcher.js"></script>
    <script type="text/javascript" src="./9.3  PREPARE_files/monospacefix.js"></script></head><body><pre id="monotest" style="display: none;">&nbsp;</pre><p id="paratest" style="display: none;">&nbsp;</p><style type="text/css" media="screen">#docContainer tt, #docContainer pre, #docContainer code{font-size: 1.2em;}</style>

    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1345454-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


<div id="docHeader">
	<div id="docHeaderLogo">
		<a href="http://www.postgresql.org/" title="PostgreSQL"><img src="./9.3  PREPARE_files/hdr_logo.png" width="206" height="80" alt="PostgreSQL"></a>
	</div>
</div>

<div id="docContainerWrap">
<div id="docContainer">
<div id="docNavSearchContainer">
<div id="docSearch">
	<form action="http://www.postgresql.org/search/" method="get">
	<div>
	<input type="hidden" name="u" value="/docs/9.3/">
	<label for="q">Search Documentation:&nbsp;</label><input type="text" id="q" name="q" size="20" onfocus="if( this.value==this.defaultValue ) this.value=&#39;&#39;;" value="Search"><input id="submit" type="submit" value="Search">
	</div>
	</form>
        <div id="docTextSize">Text Size: <a href="http://www.postgresql.org/docs/9.3/static/sql-prepare.html#" onclick="setActiveStyleSheet(&#39;Normal Text&#39;); return false;" onkeypress="return false;" title="Normal Text Size">Normal</a> / <a href="http://www.postgresql.org/docs/9.3/static/sql-prepare.html#" onclick="setActiveStyleSheet(&#39;Large Text&#39;); return false;" onkeypress="return false;" title="Large Text Size">Large</a></div>
</div>
<div id="docNav">
<a href="http://www.postgresql.org/" title="Home">Home</a> → <a href="http://www.postgresql.org/docs" title="Documentation">Documentation</a> → <a href="http://www.postgresql.org/docs/manuals" title="Manuals">Manuals</a> → <a href="http://www.postgresql.org/docs/9.3/static/index.html">PostgreSQL 9.3</a>
</div>
<div id="docVersions">

This page in other versions:

	
	
	<a href="http://www.postgresql.org/docs/9.2/static/sql-prepare.html" title="This page in version 9.2">9.2</a>
	

	/
	
	<a href="http://www.postgresql.org/docs/9.1/static/sql-prepare.html" title="This page in version 9.1">9.1</a>
	

	/
	
	<a href="http://www.postgresql.org/docs/9.0/static/sql-prepare.html" title="This page in version 9.0">9.0</a>
	

	/
	
	<a href="http://www.postgresql.org/docs/8.4/static/sql-prepare.html" title="This page in version 8.4">8.4</a>
	



&nbsp;|&nbsp; Unsupported versions:

	
	
	<b>9.3</b>
	

	/
	
	<a href="http://www.postgresql.org/docs/8.3/static/sql-prepare.html" title="This page in version 8.3" rel="nofollow">8.3</a>
	

	/
	
	<a href="http://www.postgresql.org/docs/8.2/static/sql-prepare.html" title="This page in version 8.2" rel="nofollow">8.2</a>
	

	/
	
	<a href="http://www.postgresql.org/docs/8.1/static/sql-prepare.html" title="This page in version 8.1" rel="nofollow">8.1</a>
	

	/
	
	<a href="http://www.postgresql.org/docs/8.0/static/sql-prepare.html" title="This page in version 8.0" rel="nofollow">8.0</a>
	

	/
	
	<a href="http://www.postgresql.org/docs/7.4/static/sql-prepare.html" title="This page in version 7.4" rel="nofollow">7.4</a>
	

	/
	
	<a href="http://www.postgresql.org/docs/7.3/static/sql-prepare.html" title="This page in version 7.3" rel="nofollow">7.3</a>
	

	/
	
	<a href="http://www.postgresql.org/docs/devel/static/sql-prepare.html" title="This page in version devel" rel="nofollow">devel</a>
	


</div>
</div>

<div id="docContent">
<div class="NAVHEADER">
  <table summary="Header navigation table" width="100%" border="0" cellpadding="0" cellspacing="0">
    <tbody><tr>
      <th colspan="5" align="center" valign="bottom"><a href="http://www.postgresql.org/docs/9.3/static/index.html">PostgreSQL 9.3beta2 Documentation</a></th>
    </tr>

    <tr>
      <td width="10%" align="left" valign="top"><a title="NOTIFY" href="http://www.postgresql.org/docs/9.3/static/sql-notify.html" accesskey="P">Prev</a></td>

      <td width="10%" align="left" valign="top"><a href="http://www.postgresql.org/docs/9.3/static/sql-commands.html" accesskey="U">Up</a></td>

      <td width="60%" align="center" valign="bottom"></td>

      <td width="20%" align="right" valign="top"><a title="PREPARE TRANSACTION" href="http://www.postgresql.org/docs/9.3/static/sql-prepare-transaction.html" accesskey="N">Next</a></td>
    </tr>
  </tbody></table>
  <hr class="c1" width="100%">
</div>

<h1><a name="SQL-PREPARE" id="SQL-PREPARE"></a>PREPARE</h1>

<div class="REFNAMEDIV">
  <a name="AEN78620" id="AEN78620"></a>

  <h2>Name</h2>PREPARE&nbsp;--&nbsp;prepare a statement for
  execution
</div>

<div class="REFSYNOPSISDIV">
  <a name="AEN78628" id="AEN78628"></a>

  <h2>Synopsis</h2>
  <pre class="SYNOPSIS">PREPARE <tt class="REPLACEABLE c2">name</tt> [ ( <tt class="REPLACEABLE c2">data_type</tt> [, ...] ) ] AS <tt class="REPLACEABLE c2">statement</tt>
</pre>
</div>

<div class="REFSECT1">
  <a name="AEN78633" id="AEN78633"></a>

  <h2>Description</h2>

  <p><tt class="COMMAND">PREPARE</tt> creates a prepared statement.
  A prepared statement is a server-side object that can be used to
  optimize performance. When the <tt class="COMMAND">PREPARE</tt>
  statement is executed, the specified statement is parsed,
  analyzed, and rewritten. When an <tt class="COMMAND">EXECUTE</tt>
  command is subsequently issued, the prepared statement is planned
  and executed. This division of labor avoids repetitive parse
  analysis work, while allowing the execution plan to depend on the
  specific parameter values supplied.</p>

  <p>Prepared statements can take parameters: values that are
  substituted into the statement when it is executed. When creating
  the prepared statement, refer to parameters by position, using
  <tt class="LITERAL">$1</tt>, <tt class="LITERAL">$2</tt>, etc. A
  corresponding list of parameter data types can optionally be
  specified. When a parameter's data type is not specified or is
  declared as <tt class="LITERAL">unknown</tt>, the type is
  inferred from the context in which the parameter is used (if
  possible). When executing the statement, specify the actual
  values for these parameters in the <tt class="COMMAND">EXECUTE</tt> statement. Refer to <a href="http://www.postgresql.org/docs/9.3/static/sql-execute.html">EXECUTE</a> for more information about
  that.</p>

  <p>Prepared statements only last for the duration of the current
  database session. When the session ends, the prepared statement
  is forgotten, so it must be recreated before being used again.
  This also means that a single prepared statement cannot be used
  by multiple simultaneous database clients; however, each client
  can create their own prepared statement to use. Prepared
  statements can be manually cleaned up using the <a href="http://www.postgresql.org/docs/9.3/static/sql-deallocate.html">DEALLOCATE</a> command.</p>

  <p>Prepared statements have the largest performance advantage
  when a single session is being used to execute a large number of
  similar statements. The performance difference will be
  particularly significant if the statements are complex to plan or
  rewrite, for example, if the query involves a join of many tables
  or requires the application of several rules. If the statement is
  relatively simple to plan and rewrite but relatively expensive to
  execute, the performance advantage of prepared statements will be
  less noticeable.</p>
</div>

<div class="REFSECT1">
  <a name="AEN78648" id="AEN78648"></a>

  <h2>Parameters</h2>

  <div class="VARIABLELIST">
    <dl>
      <dt><tt class="REPLACEABLE c2">name</tt></dt>

      <dd>
        <p>An arbitrary name given to this particular prepared
        statement. It must be unique within a single session and is
        subsequently used to execute or deallocate a previously
        prepared statement.</p>
      </dd>

      <dt><tt class="REPLACEABLE c2">data_type</tt></dt>

      <dd>
        <p>The data type of a parameter to the prepared statement.
        If the data type of a particular parameter is unspecified
        or is specified as <tt class="LITERAL">unknown</tt>, it
        will be inferred from the context in which the parameter is
        used. To refer to the parameters in the prepared statement
        itself, use <tt class="LITERAL">$1</tt>, <tt class="LITERAL">$2</tt>, etc.</p>
      </dd>

      <dt><tt class="REPLACEABLE c2">statement</tt></dt>

      <dd>
        <p>Any <tt class="COMMAND">SELECT</tt>, <tt class="COMMAND">INSERT</tt>, <tt class="COMMAND">UPDATE</tt>,
        <tt class="COMMAND">DELETE</tt>, or <tt class="COMMAND">VALUES</tt> statement.</p>
      </dd>
    </dl>
  </div>
</div>

<div class="REFSECT1">
  <a name="AEN78674" id="AEN78674"></a>

  <h2>Notes</h2>

  <p>If a prepared statement is executed enough times, the server
  may eventually decide to save and re-use a generic plan rather
  than re-planning each time. This will occur immediately if the
  prepared statement has no parameters; otherwise it occurs only if
  the generic plan appears to be not much more expensive than a
  plan that depends on specific parameter values. Typically, a
  generic plan will be selected only if the query's performance is
  estimated to be fairly insensitive to the specific parameter
  values supplied.</p>

  <p>To examine the query plan <span class="PRODUCTNAME">PostgreSQL</span> is using for a prepared
  statement, use <a href="http://www.postgresql.org/docs/9.3/static/sql-explain.html">EXPLAIN</a>. If a
  generic plan is in use, it will contain parameter symbols
  <tt class="LITERAL">$<tt class="REPLACEABLE c2">n</tt></tt>,
  while a custom plan will have the current actual parameter values
  substituted into it.</p>

  <p>For more information on query planning and the statistics
  collected by <span class="PRODUCTNAME">PostgreSQL</span> for that
  purpose, see the <a href="http://www.postgresql.org/docs/9.3/static/sql-analyze.html">ANALYZE</a>
  documentation.</p>

  <p>Although the main point of a prepared statement is to avoid
  repeated parse analysis and planning of the statement,
  <span class="PRODUCTNAME">PostgreSQL</span> will force
  re-analysis and re-planning of the statement before using it
  whenever database objects used in the statement have undergone
  definitional (DDL) changes since the previous use of the prepared
  statement. Also, if the value of <a href="http://www.postgresql.org/docs/9.3/static/runtime-config-client.html#GUC-SEARCH-PATH">search_path</a>
  changes from one use to the next, the statement will be re-parsed
  using the new <tt class="VARNAME">search_path</tt>. (This latter
  behavior is new as of <span class="PRODUCTNAME">PostgreSQL</span>
  9.3.) These rules make use of a prepared statement semantically
  almost equivalent to re-submitting the same query text over and
  over, but with a performance benefit if no object definitions are
  changed, especially if the best plan remains the same across
  uses. An example of a case where the semantic equivalence is not
  perfect is that if the statement refers to a table by an
  unqualified name, and then a new table of the same name is
  created in a schema appearing earlier in the <tt class="VARNAME">search_path</tt>, no automatic re-parse will occur
  since no object used in the statement changed. However, if some
  other change forces a re-parse, the new table will be referenced
  in subsequent uses.</p>

  <p>You can see all prepared statements available in the session
  by querying the <a href="http://www.postgresql.org/docs/9.3/static/view-pg-prepared-statements.html"><tt class="STRUCTNAME">pg_prepared_statements</tt></a> system view.</p>
</div>

<div class="REFSECT1">
  <a name="SQL-PREPARE-EXAMPLES" id="SQL-PREPARE-EXAMPLES"></a>

  <h2>Examples</h2>

  <p>Create a prepared statement for an <tt class="COMMAND">INSERT</tt> statement, and then execute it:</p>
  <pre class="PROGRAMLISTING">PREPARE fooplan (int, text, bool, numeric) AS
    INSERT INTO foo VALUES($1, $2, $3, $4);
EXECUTE fooplan(1, 'Hunter Valley', 't', 200.00);
</pre>

  <p>Create a prepared statement for a <tt class="COMMAND">SELECT</tt> statement, and then execute it:</p>
  <pre class="PROGRAMLISTING">PREPARE usrrptplan (int) AS
    SELECT * FROM users u, logs l WHERE u.usrid=$1 AND u.usrid=l.usrid
    AND l.date = $2;
EXECUTE usrrptplan(1, current_date);
</pre>

  <p>Note that the data type of the second parameter is not
  specified, so it is inferred from the context in which <tt class="LITERAL">$2</tt> is used.</p>
</div>

<div class="REFSECT1">
  <a name="AEN78703" id="AEN78703"></a>

  <h2>Compatibility</h2>

  <p>The SQL standard includes a <tt class="COMMAND">PREPARE</tt>
  statement, but it is only for use in embedded SQL. This version
  of the <tt class="COMMAND">PREPARE</tt> statement also uses a
  somewhat different syntax.</p>
</div>

<div class="REFSECT1">
  <a name="AEN78708" id="AEN78708"></a>

  <h2>See Also</h2><a href="http://www.postgresql.org/docs/9.3/static/sql-deallocate.html">DEALLOCATE</a>,
  <a href="http://www.postgresql.org/docs/9.3/static/sql-execute.html">EXECUTE</a>
</div>

<div class="NAVFOOTER">
  <hr class="c1" width="100%">

  <table summary="Footer navigation table" width="100%" border="0" cellpadding="0" cellspacing="0">
    <tbody><tr>
      <td width="33%" align="left" valign="top"><a href="http://www.postgresql.org/docs/9.3/static/sql-notify.html" accesskey="P">Prev</a></td>

      <td width="34%" align="center" valign="top"><a href="http://www.postgresql.org/docs/9.3/static/index.html" accesskey="H">Home</a></td>

      <td width="33%" align="right" valign="top"><a href="http://www.postgresql.org/docs/9.3/static/sql-prepare-transaction.html" accesskey="N">Next</a></td>
    </tr>

    <tr>
      <td width="33%" align="left" valign="top">NOTIFY</td>

      <td width="34%" align="center" valign="top"><a href="http://www.postgresql.org/docs/9.3/static/sql-commands.html" accesskey="U">Up</a></td>

      <td width="33%" align="right" valign="top">PREPARE
      TRANSACTION</td>
    </tr>
  </tbody></table>
</div>

</div>

<div id="docComments">



</div>

<div id="docFooter">
    <a href="http://www.postgresql.org/about/privacypolicy">Privacy Policy</a> |
    <a href="http://www.postgresql.org/about/">About PostgreSQL</a><br>
Copyright © 1996-2013 The PostgreSQL Global Development Group
</div>
</div>
</div>


</body></html>